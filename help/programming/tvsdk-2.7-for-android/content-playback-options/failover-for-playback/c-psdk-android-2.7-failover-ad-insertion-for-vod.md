---
description: 视频点播(VOD)广告插入过程包括广告解析、广告插入和广告播放阶段。 对于广告跟踪，TVSDK必须通知远程跟踪服务器每个广告的播放进度。 出现意外情况时，TVSDK会采取适当的操作。
seo-description: 视频点播(VOD)广告插入过程包括广告解析、广告插入和广告播放阶段。 对于广告跟踪，TVSDK必须通知远程跟踪服务器每个广告的播放进度。 出现意外情况时，TVSDK会采取适当的操作。
seo-title: VOD广告插入和故障转移
title: VOD广告插入和故障转移
uuid: 1f813065-9310-4495-9fbb-d90eda8ac8bd
translation-type: tm+mt
source-git-commit: 812d04037c3b18f8d8cdd0d18430c686c3eee1ff
workflow-type: tm+mt
source-wordcount: '736'
ht-degree: 0%

---


# VOD {#advertising-insertion-and-failover-for-vod}的广告插入和故障转移

视频点播(VOD)广告插入过程包括广告解析、广告插入和广告播放阶段。 对于广告跟踪，TVSDK必须通知远程跟踪服务器每个广告的播放进度。 出现意外情况时，TVSDK会采取适当的操作。

## 广告分辨阶段{#section_5DD3A7DA79E946298BFF829A60202E1C}

TVSDK与广告投放服务(如Adobe Primetime广告决策)联系，并尝试获取与广告视频流对应的主播放列表文件。 在广告解析阶段，TVSDK对远程广告投放服务器进行HTTP调用并解析服务器的响应。

TVSDK支持以下类型的广告提供商：

* 元数据广告提供商

   广告数据以纯文本JSON文件进行编码。
* Primetime广告决策广告提供商

   TVSDK向Primetime广告决策后端服务器发送请求，包括一组定位参数和资产标识号。 Primetime广告决策采用同步多媒体集成语言(SMIL)文档做出响应，该语言包含所需的广告信息。
* 自定义广告标记提供者

   处理从服务器端将广告烧录到流中的情况。 TVSDK不执行实际的广告插入，但需要跟踪在服务器端插入的广告。 此提供者设置TVSDK用于执行广告跟踪的广告标记。

在此阶段可能发生以下故障转移情况之一：

* 无法检索数据，因为例如，缺少连接或服务器端错误，如找不到资源等。
* 已检索数据，但格式无效。

   这可能是因为，例如，分析入站数据失败。

TVSDK发出有关该错误的警告通知并继续处理。

## 广告插入阶段{#section_29F7F7756C8B40B99AD4C3DD16B72B5B}

TVSDK将替代内容（广告）插入到与主内容对应的时间轴中。

广告解析阶段完成后，TVSDK将有一个按顺序列表的广告资源，这些资源分组为广告分段。 每个广告中断都使用以毫秒为单位的开始时间值定位在主内容时间线上。 广告中断中的每个广告都有一个持续时间属性，也以毫秒表示。 广告中断的广告被链接起来，因此广告中断的持续时间等于单个合成广告的持续时间的总和。

在此阶段可能发生故障转移，在广告插入过程中可能在时间轴上发生冲突。 对于广告中断开始时间／持续时间值的特定组合，广告区段可能会重叠。 当广告片段的最后一部分与下一个广告片段中第一个广告的开头相交时，会发生此重叠。 在这些情况下，TVSDK放弃以后的广告中断，并继续广告插入过程和列表上的下一个项目，直到所有广告中断被插入或丢弃。

TVSDK发出有关该错误的警告通知并继续处理。

## 广告播放阶段{#section_DA816F88AF8A4A5A8FD0DE2D54A86031}

TVSDK下载广告段并在设备屏幕上呈现它们。

现在，TVSDK已解析广告，将广告放在时间轴上并尝试在屏幕上呈现内容。

以下几类错误可能会在以下阶段发生：

* 连接到主机服务器时。
* 下载清单文件时。
* 下载媒体区段时。

TVSDK将触发的事件转发到您的应用程序，包括在以下情况下触发的通知事件:

* 发生故障转移。
* 用户档案因故障转移算法而发生更改。
* 已考虑所有故障转移选项，并且无法自动执行其他操作。

   您的应用程序需要采取相应的操作。

无论是否发生错误，TVSDK都会为每个`onAdBreakStart`调用`onAdBreakComplete`，每个`onAdStart`调用`onAdComplete`。 但是，如果无法下载区段，则时间轴中可能存在间隙。 当间隙足够大时，播放头位置中的值和报告的广告进度可能会出现不连续。
