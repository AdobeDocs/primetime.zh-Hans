---
description: 视频点播(VOD)广告插入过程包括广告解析、广告插入和广告播放阶段。 对于广告跟踪，浏览器TVSDK必须通知远程跟踪服务器每个广告的播放进度。 当出现意外情况时，会采取适当行动。
title: 用于VOD的广告插入和故障转移
exl-id: 62b82f56-e8c7-4c44-8b70-f204908777c5
source-git-commit: be43bbbd1051886c8979ff590a3197b2a7249b6a
workflow-type: tm+mt
source-wordcount: '671'
ht-degree: 0%

---

# 用于VOD的广告插入和故障转移{#advertising-insertion-and-failover-for-vod}

视频点播(VOD)广告插入过程包括广告解析、广告插入和广告播放阶段。 对于广告跟踪，浏览器TVSDK必须通知远程跟踪服务器每个广告的播放进度。 当出现意外情况时，会采取适当行动。

## 广告解析阶段 {#section_F562CD6D0EF04AA9A0A3C0176A4EC340}

浏览器TVSDK联系广告投放服务(例如Adobe Primetime广告决策)，并尝试获取与广告的视频流对应的主播放列表文件。 在广告解析阶段，浏览器TVSDK对远程广告投放服务器进行HTTP调用并解析服务器的响应。

浏览器TVSDK支持以下类型的广告提供程序：

* 元数据广告提供程序

   广告数据以纯文本JSON文件进行编码。
* Adobe Primetime ad decisioning广告提供商

   浏览器TVSDK向Adobe Primetime ad decisioning后端服务器发送请求，包括一组定位参数和资产标识号。 Adobe Primetime ad decisioning使用包含所需广告信息的SMIL（同步多媒体集成语言）文档进行响应。

   在此阶段中可能会发生以下故障切换情况之一：

   * 无法检索数据，原因包括缺少连接或服务器端错误，例如无法找到资源等。
   * 已检索数据，但格式无效。

      例如，出现这种情况可能是因为解析入站数据失败。
   浏览器TVSDK会发出有关错误的警告通知并继续处理。

## 广告插入阶段 {#section_88A0E4FA12394717A9D85689BD11D59F}

浏览器TVSDK将替代内容（广告）插入到与主内容对应的时间轴中。

当广告解决阶段完成时，浏览器TVSDK将有一个有序的广告资源列表，这些资源将分组到广告时间中。 每个广告时间使用以毫秒(ms)表示的开始时间值在主内容时间轴上定位。 广告时间中的每个广告都有一个duration属性，该属性也以毫秒表示。 广告时间中的广告逐一链接在一起。 因此，广告插播的持续时间等于各个构成广告的持续时间总和。

在此阶段，可能会发生故障转移，并且在广告插入期间时间轴上可能会发生冲突。 对于广告时间开始时间/持续时间值的特定组合，广告区段可能会重叠。 当广告插播的最后一部分与下一个广告插播中第一个广告的开始交叉时，会发生重叠。 在这些情况下，浏览器TVSDK会丢弃较晚的广告时间，并使用列表上的下一个项目继续广告插入过程，直到插入或丢弃所有广告时间为止。

浏览器TVSDK会发出有关错误的警告通知并继续处理。

## 广告播放阶段 {#section_7B0073BE9A744C74929263182C1243FC}

浏览器TVSDK会下载广告区段并在设备屏幕上呈现它们。

此时，浏览器TVSDK已解析广告，将其定位在时间轴上，并尝试在屏幕上呈现内容。

此阶段可能会出现以下主要错误类别：

* 连接到主机服务器时出错
* 下载清单文件时出错
* 下载媒体区段时出错

对于所有三个错误类，浏览器TVSDK会将触发的事件转发到应用程序，包括：

* 发生故障转移时触发的通知事件。
* 由于故障转移算法而更改配置文件时的通知事件。
* 当考虑了所有故障转移选项且无法自动执行其他操作时触发的通知事件。

   您的应用程序需要采取相应的操作。

无论是否出现错误，浏览器TVSDK都会在广告时间开始和完成时通知您。 但是，如果无法下载区段，则时间轴可能存在间隙。 当间隙足够大时，播放头位置和报告的广告进度中的值可能会显示不连续。
