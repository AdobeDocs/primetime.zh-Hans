---
description: 您可以处理实时视频流中的封锁期，并在封锁期期间提供替代内容。
seo-description: 您可以处理实时视频流中的封锁期，并在封锁期期间提供替代内容。
seo-title: 处理实时流中的封锁
title: 处理实时流中的封锁
uuid: df933087-c8a8-49eb-a016-6dfd971c219c
translation-type: tm+mt
source-git-commit: 040655d8ba5f91c98ed0584c08db226ffe1e0f4e

---


# 处理实时流中的封锁{#handle-blackouts-in-live-streams}

您可以处理实时视频流中的封锁期，并在封锁期期间提供替代内容。

当实时流中发生封锁时，您的播放器使用事件句柄检测封锁并向那些没有资格观看主流的用户提供替代内容。 播放器检测封锁期的开始和结束，将主流的播放切换到备用流，并在封锁期结束时切换回主流。

在您的客户端应用程序中，您订阅TVSDK中的封锁标记。 当收到新定时元数 *据对象的通知* ，您将解析定时元数据对象的数据以识别该对象指示封锁条目还是退出。 对于已识别的封锁期，您调用相关的TVSDK元素在封锁期开始时切换到替代内容，并在封锁期结束时再次切换到主内容。

>[!TIP]
>
>在播放内容之前，仍会从清单下载密钥。

当用户在封锁期结束后连接到实时流，并及时滚动回到封锁期后，内容将播放。

>[!IMPORTANT]
>
>如果所有键请求都失败，则解析清单时将引发错误。 如果某些请求失败，而某些请求成功，TVSDK将尝试播放内容。 如果TVSDK尝试播放内容的某一部分，但没有有效的密钥来解密此内容，则返回错误。

要处理实时流中的封锁期，请执行以下操作：

1. 通过订阅实时流清单中的封锁标签，将应用程序设置为检测封锁标签。

   TVSDK本身不检测封锁标签；您必须订阅封锁标记才能在清单文件解析过程中遇到标记时接收通知。
1. 为播放器订阅的标记创建事件监听器。

   当您的播放器在前景（主内容）或背景（备用内容）流清单中订阅（例如，封锁标签）的标记出现时，TVSDK将调度 `TimedMetadataEvent` 并为 `TimedMetadataObject` 创建 `TimedMetadataEvent`。
1. 为前台和后台流的定时元数据事件实施处理函数。

   在这些处理函数中，从定时元数据事件对象获取封锁期的开始和结束时间。
1. 为停电做 `MediaPlayer` 好准备。

   当进入 `MediaPlayer` PREPARED状态时，您计算并准备封锁范围，并将它们设置在对象 `MediaPlayer` 上。

1. 对于播放头位置的每次更新，请检查列表 `TimedMetadataObjects`。

   这是播放器检测封锁期开始和结束的位置，并在发生封锁期时跟踪其时间。

1. 创建用于在封锁期开始和结束时切换内容的方法。

   当封锁期开始时，将主内容切换到背景，并将替代内容切换为主流。 继续在后台提取和解析原始清单并继续检查“封锁结束”标签，这样，在封锁结束时播放器可以重新加入原始流。

