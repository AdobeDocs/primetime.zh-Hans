---
description: 您可以处理实时视频流中的封锁期，并在封锁期期间提供替代内容。
title: 处理实时流中的封锁
translation-type: tm+mt
source-git-commit: 89bdda1d4bd5c126f19ba75a819942df901183d1
workflow-type: tm+mt
source-wordcount: '519'
ht-degree: 0%

---


# 处理实时流中的封锁{#handle-blackouts-in-live-streams}

您可以处理实时视频流中的封锁期，并在封锁期期间提供替代内容。

当实时流中发生封锁时，您的播放器使用事件处理函数检测封锁并向那些不合格观看主流的用户提供替代内容。 您的播放器检测封锁期的开始和结束，将主流的播放切换到备用流，并在封锁期结束时切换回主流。

在您的客户端应用程序中，您订阅TVSDK中的封锁标记。 当收到新&#x200B;*定时元数据*&#x200B;对象的通知时，您将解析定时元数据对象的数据以确定该对象指示封锁进入还是退出。 对于已识别的封锁，您调用相关TVSDK元素以在封锁开始时切换到替代内容，并在封锁结束时再次返回到主内容。

>[!TIP]
>
>在播放内容之前，仍从清单下载密钥。

当用户在封锁期结束后连接到实时流，并及时回滚到封锁期时，内容将播放。

>[!IMPORTANT]
>
>如果所有密钥请求都失败，则解析清单时将引发错误。 如果某些请求失败，而某些请求成功，TVSDK将尝试播放内容。 如果TVSDK尝试播放内容的某一部分，但没有有效密钥来解密此内容，则返回错误。

要处理实时流中的封锁：

1. 通过订阅实时流清单中的封锁标签，设置应用程序以检测封锁标签。

   TVSDK本身不检测封锁标签；您必须订阅封锁标签才能在清单文件解析期间遇到标签时接收通知。
1. 为播放器订阅的标签创建事件侦听器。

   当播放器在前景（主内容）或背景（备用内容）流清单中订阅（例如封锁标记）的标记时，TVSDK将调度`TimedMetadataEvent`并为`TimedMetadataEvent`创建`TimedMetadataObject`。
1. 为前台和后台流的定时元数据事件实现处理函数。

   在这些处理函数中，从定时元数据事件对象获取封锁期的开始和结束时间。
1. 为封锁准备`MediaPlayer`。

   当`MediaPlayer`进入PREPARED状态时，您将计算并准备封锁范围，并在`MediaPlayer`对象上设置它们。

1. 对于每次对播放头位置的更新，检查`TimedMetadataObjects`的列表。

   这是您的播放器检测封锁开始和结束的位置，并在发生封锁时跟踪其时间。

1. 创建用于在封锁期的开始和结束时切换内容的方法。

   当封锁期开始时，将主内容切换到后台，并将备用内容切换为主流。 继续在后台提取和分析原始清单，并继续检查“封锁结束”标签，以便在封锁结束时播放器可以重新加入原始流。

