---
description: 您可以处理实时视频流中的封锁并在封锁期间提供替代内容。
title: 处理实时流中的封锁
source-git-commit: 02ebc3548a254b2a6554f1ab34afbb3ea5f09bb8
workflow-type: tm+mt
source-wordcount: '519'
ht-degree: 0%

---

# 处理实时流中的封锁{#handle-blackouts-in-live-streams}

您可以处理实时视频流中的封锁并在封锁期间提供替代内容。

当实时流中发生中断时，您的播放器会使用事件处理程序来检测该中断，并向没有资格观看主流的用户提供替代内容。 您的播放器会检测封锁期的开始和结束，将播放从主流切换到备用流，并在封锁期结束时切换回主流。

在客户端应用程序中，您订阅TVSDK中的封锁标记。 在收到新通知时 *定时元数据* 对象时，可以解析定时元数据对象的数据以确定该对象是指示封锁进入还是退出。 对于标识的封锁，在封锁开始时调用相关的TVSDK元素以切换到替代内容，然后在封锁结束后再次调用以返回到主内容。

>[!TIP]
>
>在播放内容之前，仍会从清单中下载密钥。

当用户在封锁期结束后连接到实时流，并及时滚动到封锁期时，将播放内容。

>[!IMPORTANT]
>
>如果所有键请求都失败，则在解析清单时会引发错误。 如果某些请求失败，而某些请求成功，则TVSDK会尝试播放内容。 如果TVSDK尝试播放内容的一部分，但没有有效密钥来解密此内容，则会返回错误。

要在实时流中处理封锁，请执行以下操作：

1. 通过订阅实时流清单中的封锁标记，将应用程序设置为检测封锁标记。

   TVSDK本身不会检测Blackout标记；您必须订阅Blackout标记才能在解析清单文件期间遇到标记时接收通知。
1. 为播放器订阅的标记创建事件侦听器。

   当播放器在前台（主内容）或后台（备用内容）流清单中订阅（例如，中断标记）的标记发生时，TVSDK将调度 `TimedMetadataEvent` 并创建 `TimedMetadataObject` 对于 `TimedMetadataEvent`.
1. 为前台和后台流的定时元数据事件实施处理程序。

   在这些处理程序中，从定时元数据事件对象获取封锁期的开始和结束时间。
1. 准备 `MediaPlayer` 用于停电。

   当 `MediaPlayer` 进入“已准备”状态，您计算并准备封锁范围并将它们设置在 `MediaPlayer` 对象。

1. 对于播放头位置的每次更新，检查 `TimedMetadataObjects`.

   在此处，您的播放器可检测封锁期的开始和结束，并跟踪封锁期的发生时间。

1. 创建用于在封锁期开始和结束时切换内容的方法。

   当中断期开始时，将主内容切换到后台，并将替代内容切换到主流。 继续获取和分析后台的原始清单，并继续检查“封锁期”标记，以便播放器在封锁期结束时能够重新加入原始流。
