---
description: TVSDK可以检测实时流主清单m3u8中的已更改播放信息，并在流播放时更新播放信息。 TVSDK支持主清单中显示或消失配置文件时的动态比特率配置文件集，包括更新之间不重叠的配置文件比特率。
title: 实时主清单更新
source-git-commit: 02ebc3548a254b2a6554f1ab34afbb3ea5f09bb8
workflow-type: tm+mt
source-wordcount: '740'
ht-degree: 0%

---

# 实时主清单更新{#live-master-manifest-update}

TVSDK可以检测实时流主清单m3u8中的已更改播放信息，并在流播放时更新播放信息。 TVSDK支持主清单中显示或消失配置文件时的动态比特率配置文件集，包括更新之间不重叠的配置文件比特率。

支持以下功能：

* 配置文件计数（增加或减少）
* 配置文件比特率（重叠或不重叠）
* 具有相同（或不同）服务器URL的配置文件
* 任何故障转移结构

必须满足以下所有条件：

* 流是实时的。
* 时间和电子标签都会更改。
* 所有演绎版信息保持不变（但URL可能有所不同）。
* DRM访问信息保持不变。
* 将区段封装在误差较小的相同的PTS和帧边界周围。

## 实时主清单更新架构 {#section_32254A0F684B4960ACC33BF6B1AEF6F1}

以下是有关TVSDK如何容纳更新的主清单的一些信息和示例。

默认情况下，此功能处于关闭状态。 如果您的应用程序通过设置更新频率（以分钟为单位）将其打开，则会在每个更新间隔后执行以下步骤：

1. TVSDK检查主清单的上次修改时间和电子标签以确定文件是否已更新。

   如果时间和电子标签都已更改，则文件将被视为已修改。
1. TVSDK将解析和分析新清单，并根据更新的性质采取适当操作。
1. 如果当前播放比特率与修改的清单的比特率匹配，则TVSDK切换到新配置文件。

   新配置文件可能来自不同的服务器或相同的服务器，并且比特率相同。 在这种情况下，过渡是平滑的。
1. 如果当前播放比特率不再存在于新清单中，则TVSDK尝试在当前配置文件中查找比特率，该比特率也存在于新清单中。

   * 如果找到匹配，则播放器首先切换到现有清单中的匹配比特率配置文件，并切换到更新清单中的匹配比特率配置文件。 这可确保过渡平滑。
   * 如果前一清单和新清单之间没有共同比特率，或者TVSDK无法切换到匹配的比特率，则TVSDK直接切换到新清单的最低比特率配置文件，并使用ABR根据带宽切换到任何允许的比特率。 这可能会导致播放出现轻微问题，但应该影响不大。

1. 如果更新成功，TVSDK将调度 `MediaPlayerItemEvent.MASTER_UPDATED` 事件。
1. 如果更新不成功，则在此更新之前将继续进行安装。

### 示例1 {#example_DB55F2B9D98741628C9B973E47A0B6A0}

以下比特率正在进行实时广播：

* 500k
* 900k
* 2100k

2100k流存在一些问题，因此需要重新启动。 主清单已更新为仅包含50万和90万。 不久之后，在210k观看此节目的用户将体验到比特率切换到900k。 看着90万的用户继续看着90万。 之后，2100k流恢复，并将其添加回主清单中。 一段时间后，在900k观看视频并且拥有带宽的用户切换到2100k。

### 示例2 {#example_485E9A9F373D454CADE5395DEC734E5D}

以下比特率正在进行实时广播：

* 500k
* 900k
* 2100k

所有这些比特率都需要重新启动。 在400k和1500k时，有两个时间流设置用于此目的。 用户被切换到400k，这是新配置的最低比特率。 当带宽足够时，某些用户会被切换到1500k。 之后，备份三位速率并更新主清单。 用户在500k时自动切换回观看状态，这是修订（原始）清单中的最低带宽。 一段时间后，用户会切换到其网络允许的最高带宽（900k或1200k）。

## 使用实时主清单更新 {#section_34AC4A9751DB4B7C8561302C6A59A1C4}

您可以打开此功能并检查相关事件。

1. 要打开实时主清单更新，请通过设置 `NetworkConfiguration.masterUpdateInterval` 属性。
1. （可选）通过侦听 `MediaPlayerItemEvent.MASTER_UPDATED` 事件。
