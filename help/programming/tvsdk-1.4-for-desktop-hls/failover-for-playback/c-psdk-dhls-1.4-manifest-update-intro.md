---
description: TVSDK可以检测主m3u8清单中的实时流播放信息的更改，并在流播放时更新播放信息。 TVSDK支持一组动态的比特率配置文件，因为配置文件从主清单中显示或消失，包括更新之间不重叠的配置文件比特率。
seo-description: TVSDK可以检测主m3u8清单中的实时流播放信息的更改，并在流播放时更新播放信息。 TVSDK支持一组动态的比特率配置文件，因为配置文件从主清单中显示或消失，包括更新之间不重叠的配置文件比特率。
seo-title: 实时主清单更新
title: 实时主清单更新
uuid: 44f8adc2-0538-4c5d-8e39-55f661d8540b
translation-type: tm+mt
source-git-commit: 040655d8ba5f91c98ed0584c08db226ffe1e0f4e

---


# 实时主清单更新{#live-master-manifest-update}

TVSDK可以检测主m3u8清单中的实时流播放信息的更改，并在流播放时更新播放信息。 TVSDK支持一组动态的比特率配置文件，因为配置文件从主清单中显示或消失，包括更新之间不重叠的配置文件比特率。

支持以下功能：

* 配置文件计数（增加或减少）
* 配置文件比特率（重叠或不重叠）
* 在同一（或不同）服务器上具有URL的配置文件
* 任何故障转移结构

必须满足以下所有条件：

* 流是实时的。
* 时间和etag都会改变。
* 所有再现信息保持不变（URL可能不同除外）。
* DRM访问信息保持不变。
* 段在较小的误差范围内围绕相同的PTS和帧边界进行封装。

## 实时主清单更新架构 {#section_32254A0F684B4960ACC33BF6B1AEF6F1}

以下是有关TVSDK如何容纳更新的主清单的一些信息和示例。

默认情况下，此功能处于关闭状态。 如果应用程序通过以分钟为单位设置更新频率来打开它，则在每次更新间隔后都会执行以下步骤：

1. TVSDK检查主清单的上次修改时间和标记以确定文件是否已更新。

   如果时间和标记都发生了更改，则文件将被视为已修改。
1. TVSDK分析并分析新清单，并根据更新的性质采取适当行动。
1. 如果当前播放的比特率与修改的清单的比特率匹配，则TVSDK将切换到新配置文件。

   新配置文件可以来自其他服务器或同一服务器，位速率相同。 在这种情况下，过渡是平滑的。
1. 如果新清单中不再存在当前播放比特率，TVSDK将尝试在新清单中也存在的当前配置文件中查找比特率。

   * 如果找到匹配，则播放器首先切换到现有清单中的匹配比特率概要，并切换到更新清单中的匹配比特率概要。 这可确保过渡平稳。
   * 如果前一清单和新清单之间没有相同的比特率，或者如果TVSDK无法切换到匹配的比特率，则TVSDK直接切换到新清单的最低比特率配置文件，并使用ABR根据带宽切换到任何允许的比特率。 这可能导致播放中出现轻微故障，但影响应该很小。

1. 如果更新成功，TVSDK将调度一个事 `MediaPlayerItemEvent.MASTER_UPDATED` 件。
1. 如果更新未成功，则从此更新之前的设置继续播放。

### 示例1 {#example_DB55F2B9D98741628C9B973E47A0B6A0}

以下位速率正在直播：

* 500k
* 900k
* 2100k

2100k流存在一些问题，因此需要重新启动它。 主清单将更新为仅包含500k和900k。 不久之后，以2100k观看此程序的用户将体验到将位速率切换为900k的情况。 90万观看者继续90万观看。 稍后，2100k流恢复，并重新添加到主清单中。 稍后，900k观看并具有带宽的用户将切换到2100k。

### 示例2 {#example_485E9A9F373D454CADE5395DEC734E5D}

以下位速率正在直播：

* 500k
* 900k
* 2100k

所有这些比特率都需要重新启动。 为此，在400k和1500k上设置了两个时间流。 用户切换到400k，这是新配置的最低位速率。 某些用户在带宽足够时切换到1500k。 之后，备份三个比特率并更新主清单。 用户在500k时自动切换回观看，这是修订的（原始）清单中最低的带宽。 稍后，用户将切换到其网络允许的最高带宽（900k或1200k）。

## 使用实时主清单更新 {#section_34AC4A9751DB4B7C8561302C6A59A1C4}

您可以打开此功能并检查相关事件。

1. 要打开实时主清单更新，请通过设置属性来设置更新频率(以分钟为单 `NetworkConfiguration.masterUpdateInterval` 位)。
1. （可选）通过侦听事件来跟踪成功的清单 `MediaPlayerItemEvent.MASTER_UPDATED` 更新。

