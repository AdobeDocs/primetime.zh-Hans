---
description: 视频点播(VOD)广告插入过程包括广告解析、广告插入和广告播放阶段。 对于广告跟踪，TVSDK必须通知远程跟踪服务器每个广告的播放进度。 当出现意外情况时，会采取适当的操作。
seo-description: 视频点播(VOD)广告插入过程包括广告解析、广告插入和广告播放阶段。 对于广告跟踪，TVSDK必须通知远程跟踪服务器每个广告的播放进度。 当出现意外情况时，会采取适当的操作。
seo-title: VOD的广告插入和故障转移
title: VOD的广告插入和故障转移
uuid: 98505f63-ac43-4ff5-9f7b-895b6135df47
translation-type: tm+mt
source-git-commit: 040655d8ba5f91c98ed0584c08db226ffe1e0f4e

---


# VOD的广告插入和故障转移{#advertising-insertion-and-failover-for-vod}

视频点播(VOD)广告插入过程包括广告解析、广告插入和广告播放阶段。 对于广告跟踪，TVSDK必须通知远程跟踪服务器每个广告的播放进度。 当出现意外情况时，会采取适当的操作。

## 广告分辨阶段 {#section_0D45C6094D724B55868B48F9A3557A8B}

TVSDK与广告交付服务（如Adobe Primetime广告决策）联系，并尝试获取与广告视频流对应的主播放列表文件。 在广告解析阶段，TVSDK对远程广告交付服务器进行HTTP调用并分析服务器的响应。

TVSDK支持以下类型的广告提供者：

* 元数据广告提供商

   广告数据以纯文本JSON文件进行编码。
* Primetime广告决策广告提供商

   TVSDK向Primetime广告决策后端服务器发送请求，包括一组定位参数和资产标识号。 Primetime广告决策使用包含所需广告信息的SMIL（同步多媒体集成语言）文档做出响应。

在此阶段，可能会发生以下故障转移情况之一：

* 由于缺乏连接或服务器端错误（如找不到资源等）等原因，无法检索数据。
* 已检索数据，但格式无效。

   这可能是因为（例如）入站数据解析失败。

TVSDK发出有关该错误的警告通知并继续处理。

## 广告插入阶段 {#section_1B18E8B5768B4873B3346294175B7340}

TVSDK将替代内容（广告）插入到与主内容对应的时间轴中。

当广告解析阶段完成时，TVSDK将有一个按广告分组的广告资源的有序列表。 每个广告中断使用以毫秒为单位的开始时间值定位在主内容时间线上。 广告中断中的每个广告都有一个持续时间属性，也以ms表示。 广告中的广告被一个接一个地链接在一起。 结果，广告中断的持续时间等于单个合成广告的持续时间的总和。

在此阶段可能发生故障转移，并且广告插入过程中可能在时间轴上发生冲突。 对于广告中断开始时间／持续时间值的特定组合，广告段可能会重叠。 当广告中断的最后一部分与下一个广告中断中第一个广告的开头交叉时，会发生重叠。 在这些情况下，放弃以后的广告中断，并继续广告插入过程和列表中的下一个项目，直到所有广告中断被插入或丢弃。

TVSDK发出有关该错误的警告通知并继续处理。

## 广告播放阶段 {#section_64777BD2CDA84EACB0A4EA6D68367CF5}

TVSDK下载广告段并在设备的屏幕上呈现它们。

此时，TVSDK已解析广告，将其放在时间轴上，并尝试在屏幕上呈现内容。

此阶段可能会出现以下主要类别的错误：

* 连接到主机服务器时出错
* 下载清单文件时出错
* 下载媒体段时出错

对于所有三个错误类，TVSDK将触发的事件转发到您的应用程序，包括：

* 故障转移时触发的通知事件。
* 配置文件因故障转移算法而发生更改时的通知事件。
* 当已考虑所有故障转移选项且无法自动执行其他操作时，将触发通知事件。

   您的应用程序需要采取相应的操作。

无论是否发生错误，TVSDK都会为 `AdBreakPlaybackEvent.AD_BREAK_COMPLETE` 每个错误 `AdBreakPlaybackEvent.AD_BREAK_STARTED` 和每 `AdPlaybackEvent.AD_COMPLETED` 个错误调用 `AdPLaybackEvent.AD_STARTED`。 但是，如果无法下载区段，则时间轴中可能会有间隙。 当间隙足够大时，播放头位置和报告的广告进度中的值可能出现不连续。
