---
description: 视频点播(VOD)广告插入过程包括广告解析、广告插入和广告播放阶段。 对于广告跟踪，TVSDK必须通知远程跟踪服务器每个广告的播放进度。 当出现意外情况时，TVSDK会采取适当措施。
title: 用于VOD的广告插入和故障转移
source-git-commit: 02ebc3548a254b2a6554f1ab34afbb3ea5f09bb8
workflow-type: tm+mt
source-wordcount: '689'
ht-degree: 0%

---

# 用于VOD的广告插入和故障转移 {#advertising-insertion-and-failover-for-vod}

视频点播(VOD)广告插入过程包括广告解析、广告插入和广告播放阶段。 对于广告跟踪，TVSDK必须通知远程跟踪服务器每个广告的播放进度。 当出现意外情况时，TVSDK会采取适当措施。

## 广告解析阶段 {#section_5DD3A7DA79E946298BFF829A60202E1C}

TVSDK联系广告投放服务(例如Adobe Primetime ad decisioning)，并尝试获取与广告的视频流对应的主播放列表文件。 在广告解析阶段，TVSDK对远程广告投放服务器进行HTTP调用并解析服务器的响应。

TVSDK支持以下类型的广告提供程序：

* 元数据广告提供程序

  广告数据以纯文本JSON文件进行编码。
* Primetime ad decisioning广告提供商

  TVSDK向Primetime ad decisioning后端服务器发送请求，包括一组定位参数和资产标识号。 Primetime ad decisioningresponse使用同步的多媒体集成语言(SMIL)文档进行响应，该文档包含所需的广告信息。
* 自定义广告标记提供程序

  处理从服务器端将广告刻录到流中的情况。 TVSDK不执行实际的广告插入，但需要跟踪在服务器端插入的广告。 此提供程序设置TVSDK用于执行广告跟踪的广告标记。

在此阶段中可能会出现以下某种故障切换情况：

* 无法检索数据，例如，由于缺少连接或服务器端错误，例如无法找到资源等。
* 已检索数据，但格式无效。

  例如，出现这种情况可能是因为解析入站数据失败。

TVSDK会发出有关该错误的警告通知并继续处理。

## 广告插入阶段 {#section_29F7F7756C8B40B99AD4C3DD16B72B5B}

TVSDK将替代内容（广告）插入到与主内容对应的时间轴中。

当广告解析阶段完成后，TVSDK会向您有序列出分组到广告时间中的广告资源。 每个广告时间通过使用以毫秒(ms)表示的开始时间值在主内容时间轴上定位。 广告时间中的每个广告都有一个持续时间属性，该属性也以毫秒表示。 广告时间中的广告被链接，因此，广告时间的持续时间等于单独撰写广告的持续时间总和。

在此阶段中可能会发生故障转移，因为在广告插入期间时间轴上可能会发生冲突。 对于广告时间开始时间/持续时间值的特定组合，广告区段可能会重叠。 当广告插播的最后部分与下一个广告插播中第一个广告的开始相交时，会发生此重叠。 在这些情况下，TVSDK会丢弃随后的广告时间，并使用列表中的下一项继续广告插入过程，直到插入或丢弃所有广告时间为止。

TVSDK会发出有关该错误的警告通知并继续处理。

## 广告播放阶段 {#section_DA816F88AF8A4A5A8FD0DE2D54A86031}

TVSDK会下载广告区段并在设备屏幕上呈现它们。

现在，TVSDK已解析广告，将广告定位在时间轴上，并尝试在屏幕上呈现内容。

以下主要错误类别可能发生在以下阶段：

* 连接到主机服务器时。
* 下载清单文件时。
* 下载媒体区段时。

TVSDK将触发的事件转发到应用程序，其中包括在以下情况下触发的通知事件：

* 发生故障转移。
* 由于故障转移算法，配置文件已更改。
* 已考虑所有故障转移选项，并且无法自动执行其他操作。

  您的应用程序需要采取相应的操作。

无论是否发生错误，TVSDK都会调用 `onAdBreakComplete` 每个 `onAdBreakStart` 和 `onAdComplete` 每隔 `onAdStart`. 但是，如果无法下载区段，则时间轴可能存在间隙。 当间隙足够大时，播放头位置和报告的广告进度中的值可能会显示不连续。
