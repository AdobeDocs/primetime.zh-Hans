---
description: 对于实时和视频点播(VOD)媒体，TVSDK通过下载与中间分辨率比特率关联的播放列表来开始播放，并下载由该播放列表定义的媒体区段。 它快速选择高分辨率的比特率播放列表及其相关媒体并继续下载过程。
title: 媒体播放和故障切换
exl-id: eef1e5ed-422b-4731-8228-d0be63f6f908
source-git-commit: be43bbbd1051886c8979ff590a3197b2a7249b6a
workflow-type: tm+mt
source-wordcount: '596'
ht-degree: 0%

---

# 媒体播放和故障切换 {#media-playback-and-failover}

对于实时和视频点播(VOD)媒体，TVSDK通过下载与中间分辨率比特率关联的播放列表来开始播放，并下载由该播放列表定义的媒体区段。 它快速选择高分辨率的比特率播放列表及其相关媒体并继续下载过程。

## 缺少播放列表故障转移 {#section_4EA0AEFA7FB84FCEA699DFB10B135368}

当整个播放列表丢失时，例如，当在顶级清单文件中指定的M3U8文件未下载时，TVSDK会尝试恢复。 如果无法恢复，应用程序将决定下一步。

如果缺少与中间分辨率比特率关联的播放列表，TVSDK将搜索具有相同分辨率的变体播放列表。 如果找到相同分辨率，TVSDK将开始从匹配位置下载变体播放列表和区段。 如果播放器未找到相同分辨率的播放列表，它将尝试循环播放其他比特率播放列表及其变体。 立即降低比特率是首选，然后是它的变体，依此类推。 如果在尝试查找有效播放列表时耗尽了所有较低比特率的播放列表及其变体，TVSDK将转到最高比特率并从此处开始计数。 如果找不到有效的播放列表，则播放过程将失败，播放器将转为“错误”状态。

您的应用程序可以决定如何处理这种情况。 例如，您可能希望关闭播放器活动并将用户定向到目录活动。 感兴趣的事件是 `STATUS_CHANGED` 事件，相应的回调是 `onStatusChanged` 方法。 以下代码用于监视播放器是否将其内部状态更改为 `ERROR`：

```java
... 
case ERROR: 
getActivity().finish(); // this is where we close the current activity (the Player activity) 
break; 
...
```

## 缺少区段故障转移 {#section_D8DF377CCB644D7FB936796DA0CC5A4B}

当缺少某个区段时（例如，当某个特定区段下载失败时），TVSDK会尝试通过各种故障转移尝试进行恢复。 如果无法恢复，则会发出错误。

如果服务器上缺少区段，例如，由于清单文件不存在、无法下载区段等，TVSDK会尝试通过尝试以下选项进行故障转移：

1. 尝试在变量文件中以相同的比特率故障转移到同一段。
1. 在同一文件中切换到备用比特率（ABR交换机）。
1. 在每个可用变量中循环遍历每个可用比特率。
1. 跳过该区段并发出警告。

当TVSDK无法获取替代区段时，将触发 `CONTENT_ERROR` 错误通知。 此通知包含一个内部通知，其中包含 `DOWNLOAD_ERROR` 代码。 如果存在问题的流是备用音轨，TVSDK将生成 `AUDIO_TRACK_ERROR` 错误通知。

如果视频引擎连续无法获取区段，则会将连续区段跳过限制为5，之后将停止播放，并且TVSDK会发出 `NATIVE_ERROR` 代码为5。

>[!NOTE]
>
>**限制**
>
>以下是一些您应该注意的限制：
>
>* 在发生故障转移时，不会考虑自适应比特率(ABR)控制参数。
>
>  这是因为故障转移机制设计为使用任何当前可用的播放列表（无论其比特率配置文件如何）作为备份流。
>* 在故障切换操作期间，可以有一个配置文件交换机。
>
>  如果在下载其中一个播放列表段期间发生错误，则会忽略ABR控制参数，例如最小允许比特率/最大允许比特率。
