---
description: 对于实时和视频点播(VOD)媒体，TVSDK通过下载与中间分辨率比特率关联的播放列表开始播放，并下载由该播放列表定义的媒体段。 它快速选择高分辨率比特率播放列表及其相关媒体并继续下载过程。
seo-description: 对于实时和视频点播(VOD)媒体，TVSDK通过下载与中间分辨率比特率关联的播放列表开始播放，并下载由该播放列表定义的媒体段。 它快速选择高分辨率比特率播放列表及其相关媒体并继续下载过程。
seo-title: 媒体播放和故障转移
title: 媒体播放和故障转移
uuid: e0072eeb-8ad1-436f-bf4a-fee6885a25bd
translation-type: tm+mt
source-git-commit: bc35da8b258056809ceaf18e33bed631047bc81b

---


# 媒体播放和故障转移 {#media-playback-and-failover}

对于实时和视频点播(VOD)媒体，TVSDK通过下载与中间分辨率比特率关联的播放列表开始播放，并下载由该播放列表定义的媒体段。 它快速选择高分辨率比特率播放列表及其相关媒体并继续下载过程。

## 缺少播放列表故障转移 {#section_4EA0AEFA7FB84FCEA699DFB10B135368}

例如，当缺少整个播放列表时，如果顶级清单文件中指定的M3U8文件不下载，TVSDK将尝试恢复。 如果无法恢复，则应用程序将决定下一步。

如果缺少与中间分辨率比特率关联的播放列表，则TVSDK将搜索以相同分辨率的变体播放列表。 如果找到相同的分辨率，TVSDK会开始从匹配位置下载变体播放列表和区段。 如果播放器找不到相同的分辨率播放列表，它将尝试循环播放其他比特率播放列表及其变体。 立即降低的比特率是第一个选择，然后是其变体，依此类推。 如果在尝试查找有效的播放列表时所有较低比特率的播放列表及其变体都已用尽，TVSDK将转到最高比特率并从那里向下计数。 如果找不到有效的播放列表，则进程将失败，并且播放器将移至ERROR状态。

您的应用程序可以确定如何处理这种情况。 例如，您可能希望关闭播放器活动并将用户定向到目录活动。 感兴趣的事件是事 `STATUS_CHANGED` 件，相应的回调是方 `onStatusChanged` 法。 以下代码监视播放器是否将其内部状态更改为 `ERROR`:

```java
... 
case ERROR: 
getActivity().finish(); // this is where we close the current activity (the Player activity) 
break; 
...
```

## 缺少细分故障转移 {#section_D8DF377CCB644D7FB936796DA0CC5A4B}

当某个区段缺失时（例如，当某个特定区段无法下载时）,TVSDK会尝试通过各种故障转移尝试进行恢复。 如果它无法恢复，则会发出错误。

如果因为（例如，清单文件不存在）、区段无法下载等原因导致服务器上缺少区段，TVSDK会尝试通过以下选项来尝试故障转移：

1. 尝试在变体文件中以相同位速率故障转移到同一段。
1. 在同一文件中切换到备用位速率（ABR开关）。
1. 循环查看每个可用变体中的每个可用位速率。
1. 跳过区段并发出警告。

当TVSDK无法获取替代段时，它会触发错误 `CONTENT_ERROR` 通知。 此通知包含包含代码的内部 `DOWNLOAD_ERROR` 通知。 如果存在问题的流是替代音轨，则TVSDK会生成错误 `AUDIO_TRACK_ERROR` 通知。

如果视频引擎连续无法获取区段，则会将连续区段跳转限制为5，然后停止播放，TVSDK会发出代 `NATIVE_ERROR` 码5的问题。

>[!R限制]
>
>以下是您应该了解的一些限制：
>* 当故障转移发生时，不考虑自适应比特率(ABR)控制参数。
>
>  
这是因为故障转移机制设计为将任何当前可用的播放列表用作备份流，而不管其比特率配置文件如何。
>* 在故障转移操作过程中，可以有一个配置文件交换机。
>
>  
如果在下载其中一个播放列表段期间发生错误，则忽略ABR控制参数，如最小／最大允许位速率。