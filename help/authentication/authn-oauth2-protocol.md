---
title: 使用OAuth 2.0协议进行身份验证
description: 使用OAuth 2.0协议进行身份验证
source-git-commit: 326f97d058646795cab5d062fa5b980235f7da37
workflow-type: tm+mt
source-wordcount: '1074'
ht-degree: 0%

---


# 使用OAuth 2.0协议进行身份验证

>[!NOTE]
>
>此页面上的内容仅供参考。 使用此API需要获得Adobe的当前许可证。 不允许未经授权使用。

## 概述 {#overview}

尽管SAML仍是US MVPD和企业一般用于身份验证的主要协议，但是，有一种明显的趋势是将OAuth 2.0作为主身份验证协议。 OAuth 2.0协议(https://tools.ietf.org/html/rfc6749)主要为消费者网站开发，并很快被Facebook、Google和Twitter等互联网巨头所采用。

OAuth 2.0非常成功，这促使企业缓慢地升级其基础架构以支持它。



## 迁移到OAuth 2.0的优势 {#adv-oauth2}

在高级别上，OAuth 2.0协议提供的功能与SAML协议相同，但存在一些重要区别。

其中一个事实是，刷新令牌流可用作后台刷新身份验证的方法。 这样，IdP（本例中为MVPD）就可以保持控制，同时仍可以提供良好的用户体验，因为出于安全考虑，用户不再需要频繁登录。

在作为服务提供商公开的数据方面，该协议还提供了更大的灵活性，因为现在可以使用令牌访问其他API以获取额外信息。 这反过来又导致了TVE用例的“动态层”协议，但它允许复杂工作流所需的灵活性。





## 切换到OAuth 2.0的要求 {#oauth-req}

要支持使用OAuth 2.0进行身份验证，MVPD需要满足以下先决条件：

首先，MVPD必须确保支持*[授权代码授予](https://oauthlib.readthedocs.io/en/latest/oauth2/grants/authcode.html) 流量。

确认支持该流程后，MVPD必须向我们提供以下信息：

* 验证端点
   * 终端将提供授权代码，稍后将用于交换刷新和访问令牌
* /token端点
   * 这将提供刷新令牌和访问令牌
   * 刷新令牌需要稳定(每次我们请求新的访问令牌时，它不得更改
   * MVPD需要为每个刷新令牌允许多个活动访问令牌
   * 此端点还将为访问令牌交换刷新令牌
* 我们需要 **用户配置文件的端点**
   * 此端点将提供userID，该用户ID对于帐户而言必须是唯一的，且不应包含任何个人身份信息
* the **/logout** 端点（可选）
   * Adobe Primetime身份验证将重定向到此端点，为MVPD提供重定向返回URI;在此端点上，MVPD可以清除客户端计算机上的Cookie，或应用任何所需的逻辑以注销
* 强烈建议支持授权客户端（不触发用户授权页面的客户端应用程序）
* 我们还需要：
   * **clientID** 和 **客户端密码** 对于集成配置
   * **生存时间** 刷新令牌和访问令牌的(TTL)值
   * 我们可以为MVPD提供授权回调和注销回调URI。 此外，如果需要，我们还可以向MVPD提供要在防火墙设置中列入白名单的IP列表。


## 验证流程 {#authn-flow}

在身份验证流程中，Adobe Primetime身份验证将与配置中选择的协议上的MVPD通信。 下图描述了OAuth 2.0流程：



![此图显示了Adobe身份验证中与配置中选择的协议上的MVPD通信的身份验证流程。](assets/authn-flow.png)

**图1:OAuth 2.0身份验证流程**



## 身份验证请求和响应 {#authn-req-response}

简而言之，支持OAuth 2.0协议的MVPD的身份验证流程遵循以下步骤：

1. 最终用户导航到程序员网站，并选择使用其MVPD凭据登录
1. 安装在程序员端的AccessEnabler，以HTTP请求的形式向Adobe Primetime身份验证端点发送身份验证请求，Adobe Primetime身份验证端点将该身份验证请求重定向到MVPD授权端点。
1. MVPD授权端点向Adobe Primetime身份验证端点发送授权代码
1. Adobe Primetime身份验证使用收到的授权代码从MVPD令牌端点请求刷新令牌和访问令牌
1. 如果令牌中未包含用户信息，则可以向用户配置文件端点发送获取用户信息和元数据的调用
1. 身份验证令牌将传递到现在可以成功浏览程序员网站的最终用户

   >[!NOTE]
   >
   >在当前访问令牌变为无效或过期后，使用刷新令牌获取新的访问令牌。


>[!IMPORTANT]
>
>在为访问令牌交换刷新令牌时，该令牌不得更改。

此限制源自客户端流，客户端流不允许服务器更新AuthNToken，对于OAuth 2.0协议，该AuthNToken还包含刷新令牌。

典型授权流执行在AuthNToken中保存的用于访问令牌的刷新令牌的交换，该访问令牌随后用于以首先经过身份验证的用户的名称执行授权调用。 如果授权服务器(MVPD)要更改刷新令牌并使旧令牌失效，则我们将无法更新有效的AuthNToken。 因此，MVPD需要支持稳定的刷新令牌，才能为它们设置OAuth 2.0集成。


## 从SAML迁移到OAuth 2.0 {#saml-auth2-migr}

将集成从SAML迁移到OAuth 2.0将由Adobe和MVPD执行。 在程序员方面不需要进行任何技术更改，但程序员可能希望在MVPD登录页面上检查/测试品牌联合。 从MVPD的角度来看，需要Oauth 2.0要求中请求的端点和其他信息。

为了 **保留单点登录**，则对于已经通过SAML获取了身份验证令牌的用户，仍会将其视为已进行了身份验证，并且其请求将通过旧的SAML集成进行路由。

从技术角度来看：

1. Adobe将在程序员和MVPD之间启用OAuth 2.0集成，而不会删除SAML集成。
1. 启用后，所有新用户都将使用OAuth 2.0流程。
1. 已通过身份验证的用户（已具有包含SAML主体ID的本地AuthN令牌）将通过SAML集成通过Adobe自动路由。
1. 对于步骤3中的用户，当其SAML生成的AuthN令牌过期后，Adobe会将他们视为新用户，其行为与步骤2中的用户类似。
1. Adobe将检查使用模式，以确定可安全停用SAML集成的时刻。

