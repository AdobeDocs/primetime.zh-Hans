---
title: 了解服务器端量度
description: 了解服务器端量度
source-git-commit: 326f97d058646795cab5d062fa5b980235f7da37
workflow-type: tm+mt
source-wordcount: '2187'
ht-degree: 0%

---

# 了解服务器端量度 {#understanding-server-side-metrics}

>[!NOTE]
>
>此页面上的内容仅供参考。 使用此API需要获得Adobe的当前许可证。 不允许未经授权使用。


## 简介 {#intro}

本文档介绍由授权服务监控(ESM)服务生成的Adobe Primetime身份验证服务器端量度。 它描述的事件与从客户端角度看的事件不同(程序员如果要在其页面/应用程序上实施测量服务(如Adobe Analytics)，将会看到什么情况)。  

## 事件摘要 {#events_summary}

从Adobe Primetime身份验证服务器端的角度来看，将生成以下事件：

* **验证流程中生成的事件**（使用MVPD进行实际登录）

   * 尝试验证通知 — 当用户发送到MVPD登录站点时，将生成此通知。
   * AuthN待定通知 — 如果用户成功使用其MVPD登录，则当用户被重定向回Primetime身份验证时，会生成此通知。
   * 已授予AuthN通知 — 当用户返回程序员网站并成功从Primetime身份验证中检索到身份验证令牌时，将生成此通知。 
* **授权流程** （只需通过MVPD检查授权）\
   *先决条件：* 有效的AuthN令牌
   * 尝试AuthZ的通知
   * 已授予AuthZ通知
* **成功的播放请求**\
   *先决条件：* 有效的AuthN和AuthZ令牌
   * 通过Adobe Primetime身份验证发出支票通知 
   * 播放请求需要授权的身份验证和授权


在 [独特用户](#unique-users) 部分。 作为概述，由于授予的身份验证和授权响应通常会缓存，因此以下公式通常适用：

* 尝试AuthN的次数\>已授予的AuthN的次数
* 尝试AuthZ的次数\>已授予的AuthZ的次数
* 尝试AuthZ的次数\>已授予的AuthN的次数（通常）
* 成功播放请求的数量\>已授予的AuthZ数量


### 示例 {#example}

以下示例显示了一个品牌一个月的服务器端量度：

|量度 | MVPD 1 | MVPD 2 | ... | MVPD n |总计 | | — | — | — | - | — | — | |身份验证成功 | 1125 | 2892 | | 2203 | SUM(MVP1+...MVPD n) | |成功授权 | 2527 | 5603 | | 5904 | SUM(MVP1+...MVPD n) | |成功播放请求 | 4201 | 10518 | | 10737 | SUM(MVP1+...MVPD n) | |独特用户 | 1375 | 2400 | | 2890 |所有已消除重复项的MVPD的所有用户总和\* | |尝试的身份验证 | 2147 | 3887 | | 3108 | SUM(MVP1+...MVPD n) | |尝试的授权 | 2889 | 6139 | | 6039 | SUM(MVP1+...MVPD n) |

</br>

在这种情况下，重复数据消除不应产生任何效果，因为不同的MVPD用户不应收到相同的用户ID。 在对两个不同品牌（但同一MVPD）进行总和时，重复数据消除的效果应该大得多。

## 事件触发器 {#event_triggers}

### 新用户 — 完整流量 {#new-user-full-flow}

下图描述了没有身份验证令牌的用户（新用户或具有身份验证令牌的用户已过期）的事件和步骤：



![](assets/ae-flow-with-events.png)



该流程涉及到往返MVPD以进行身份验证(#5到\#7)和授权(\#11)。



流程完成后，身份验证和授权令牌会缓存在用户设备上。 身份验证令牌的生存时间(TTL)值介于6小时到90天之间。 AuthN令牌过期会自动强制AuthZ令牌过期。 授权令牌的TTL值通常为24小时。

| 已触发服务器端事件 | <ul><li>身份验证尝试、身份验证挂起、已授予身份验证</li><li>授权尝试，已授权</li><li>成功播放请求</li></ul> |
|---|---|


### 已缓存返回用户 — AuthZ和AuthN令牌

对于缓存了有效AuthZ和AuthN令牌的用户，会执行以下步骤：


![](assets/ae-flow-tokens-cached-web.png)



调用时会自动触发该事件 `getAuthorization()`，且仅涉及对Adobe Primetime身份验证的检查。 MVPD未参与此流程。


| 已触发服务器端事件 | *成功播放请求 |
|---|---|


### 旧用户 — 已缓存AuthN令牌，AuthZ令牌已过期

对于仍具有有效AuthN令牌的用户，会执行以下步骤：

![](assets/ae-flow-authn-token-cached.png)


此流程涉及到MVPD的往返。


| 已触发服务器端事件 | <ul><li>授权尝试，授权确定</li><li>成功播放请求</li> |
|---|---|

## 身份验证事件 {#authn_events}

### 身份验证尝试 {#authentication-attempt}

如上图所示，仅当用户往返MVPD时，才会触发身份验证事件；身份验证事件不包括缓存的令牌身份验证。

用户从选取器单击特定MVPD后，将触发身份验证尝试事件。

* MVPD端与此类似的第一个事件是页面加载
* Adobe Primetime身份验证不计算用户多次尝试登录MVPD页面（密码不正确，请重试）
* 多次尝试被计为一次尝试
* 某些MVPD还在“身份验证”步骤中执行授权，如果授权失败，用户将不会被重定向回。

### 身份验证挂起 {#authentication-pending}

当重定向到Adobe Primetime身份验证的过程开始时，会发生此事件。

### 已授予身份验证 {#authentication-granted}

用户是MVPD的已知订阅者，通常使用付费电视订阅，但有时只使用Internet访问。 成功的身份验证可能是因为用户通过其MVPD明确输入了有效凭据，或者因为他们之前输入了有效凭据并选中了“记住我”（并且上一个会话尚未过期）。

因此，MVPD会向Adobe Primetime身份验证发送对身份验证请求的正面响应，而Adobe Primetime身份验证会创建 *AuthN令牌*.

* 身份验证通常缓存较长时间（一个月或更长时间）。 因此，在令牌过期并重新启动流程之前，身份验证事件将不再存在。
* 通过单点登录从其他网站/应用程序进入将不会触发身份验证事件。

 

### 组合身份验证 {#comcast-authentication}

与其他MVPD相比，Comcast具有不同的AuthN流。

以下功能描述了这些差异：

* **会话Cookie行为**:这会导致在用户关闭浏览器后完全删除任何身份验证令牌。 此功能仅在Web上存在。 主要目的是确保您的Comcast会话不会在不安全/共享的计算机上持久保留。 其影响是，与其余的MVPD相比，将有更多的身份验证尝试/已授权的流。

* **每个请求者ID的AuthN**:Comcast不允许将AuthN状态从一个请求者ID缓存到另一个请求者ID。 因此，每个站点/应用程序都必须转到Comcast才能获取身份验证令牌。 除了用户体验考虑因素之外，与上述情况一样，影响在于将生成更多身份验证尝试/已授予的事件。

* **被动身份验证**:为了改善用户体验，但仍然保持每个请求者ID的AuthN功能，隐藏的iFrame中会发生被动身份验证流程。 用户将看不到任何内容，但事件仍将像之前一样触发。

如果用户在Comcast登录页面上单击“记住我”，则随后访问此页面（在2周内）将只是一次快速重定向返回。 否则，用户实际上必须在页面上进行身份验证。

### 身份验证失败 {#unsuccessful-authentication}

失败的身份验证不是Adobe Primetime身份验证中的事件本身，但可以计算为尝试和成功之间的差异。

在2013年5月版中，Adobe Primetime身份验证将为由于系统或网络错误而失败的身份验证添加错误代码，包括DRM错误（令牌绑定失败）和LSO错误（没有写入令牌的空间等）。

### 身份验证转化率 {#authenitication-conversion-rate}

程序员可以跟踪的一个有趣量度是身份验证转化率，计算方式为（已授予AuthN请求/AuthN）%。

有关量度的一些说明：

* 由于它是一个基于事件的量度，因此它实际上并不反映独特用户转化率（如果用户尝试8次并第9次成功），这将在上述转化率中反映得非常糟糕。
* Adobe Primetime身份验证（在服务器端）中尚无法计算基于唯一身份验证的转换。
* 如果网站/应用程序中存在自动AuthN重试，则也会使上述量度出现偏差。

## 授权事件 {#authorization_events}

### 授权尝试 {#authorization_attempt}

除了获取身份验证令牌之外，用户还必须在播放内容之前获取授权令牌。 这通常在身份验证后或授权令牌过期时发生。 由于此检查在服务器端完成(从Adobe Primetime身份验证服务器到MVPD服务器)，因此用户无需执行任何操作。

### 授权 {#authorization-granted}

“授权”表示经过验证的用户的订阅包括所请求的编程。

请注意，并非所有MVPD都支持单独的授权步骤；对于某些身份验证，则等同于授权。 MVPD向Adobe Primetime身份验证发送对后通道AuthZ请求的成功响应，而Adobe Primetime身份验证会创建AuthZ令牌。

* AuthZ令牌会缓存一段时间（通常为24小时）。在此期间，不会触发AuthZ事件。
* 有些MVPD使用资产级别授权，另一些则使用渠道级别授权； — 根据使用的AuthZ事件，会触发更多或更少的AuthZ事件。 即使对于渠道级别授权，缓存也已到位 — 因此，如果在不到24小时内请求同一资产，则不会触发任何事件。

### 拒绝授权 {#authorization-denied}

如果拒绝授权，则经过身份验证的用户没有对所请求的编程的确认订阅。 最可能的原因是该渠道不是用户订阅包的一部分，但这也可能反映用户只能从MVPD访问Internet。

对于某些MVPD，即使用户只有MVPD的Internet订阅（无付费电视订阅），用户仍会成功进行身份验证。 在这种情况下，即使用户请求授权的渠道位于基包中，授权也将被拒绝。

某些MVPD为AuthZ拒绝提供自定义错误消息，这些消息可能包含升级其包的选件。


### 授权转化率 {#authorization-conversion-rate}

身份验证转化率可以计算为（已授予AuthZ请求/AuthZ）%。

### 成功的播放请求 {#successful-play-request}

经过身份验证和授权的用户可以查看受保护的内容。

在成功播放请求后，Adobe Primetime身份验证会生成短期的媒体令牌，声明用户有权查看所请求的视频。 程序员使用此媒体令牌进一步验证潜在查看者。 媒体令牌会作为成功的播放请求进行跟踪。

* Adobe Primetime身份验证 *not* 跟踪视频播放是否在生成媒体令牌后实际开始。 例如，如果内容存在地域限制，则交易仍会计为成功的播放请求，即使流实际上从未开始。
* 由于AuthN和AuthZ令牌在一段时间内缓存MVPD响应，因此成功的播放请求事件是量度中最频繁的事件。

## 独特用户 {#unique-users}

### 定义 {#definition}

成功验证后，Adobe Primetime身份验证会根据返回的MVPD用户ID值跟踪唯一用户的存在。  此值基于用户的登录信息，但不包含任何个人身份信息。

此值还会传递到sendTrackingData回调中的站点/应用程序。

此值可以跨设备持续存在（MVPD为给定用户生成相同的值，无论登录发生在何处），也可以是临时值(对于每次登录，都会生成一个新值，MVPD会在其后端映射该值。 通常，MVPD向Adobe Primetime身份验证提供的值会在会话和设备之间持久保留，但如所述，持久性既无保证也无验证。

此值用作计算独特用户的方法。 在特定时间间隔内，报告的值（每个请求者ID/间隔/MVPD）会消除重复项。 因此，每日独特用户数的总和通常与每月值不同，而每月值的值则较低。

此数字包括Adobe Primetime身份验证中的所有事件，减去身份验证尝试（没有用户ID），但包括尝试（可能失败）的授权。

### 示例 {#examples}

#### 第1天 {#day1}

用户XYZ访问网站观看视频。

触发的事件：

* AuthN尝试（尚未有唯一用户）
* 已授予AuthN
   * 此时，我们会根据MVPD返回的内容来唯一标识用户，因此每日独特用户计数将增加1
   * AuthN令牌已缓存30天
* 身份验证Z尝试/已授予事件
   * 缓存了1天的AuthZ令牌
* 成功播放请求事件

#### 第1天（稍后） {#day1-later-on}

用户XYZ观看另一个视频。

触发的事件：

* 成功播放请求事件（其余事件将缓存）
* 每日或每月独特数没有增加

#### 第3天 {#day3}

用户XYZ观看另一个视频。

触发的事件：

* 身份验证Z尝试/已授予事件
   * 自第1天开始1天缓存已过期
* 成功播放请求事件（其余事件将缓存）
* 每日独特用户数增加1 — 每月独特用户数仍为1

#### 第31天 {#day31}

用户XYZ观看另一个视频。

与第1天AuthN缓存过期后的情况相同。

如果同一用户未通过授权，则每月独特用户计数仍会增加1，因为有两个事件包含用户ID — 已授予的身份验证和授权尝试。

### 单点登录(SSO) {#single-sign-on-sso}

在某些情况下，独特用户的数量可能大于成功身份验证的数量。 通常情况下，许多用户会通过其他网站/应用程序的单点登录(SSO)进入，并且只需要对当前网站/应用程序获得授权即可。

### 比较客户端和服务器端独特用户 {#comparing-client-side-and-server-side-unique-users}

如果用户ID值来自 `sendTrackingData()` 用于在客户端计算独特用户数，则客户端和服务器端号应匹配。

如果差异很大，则通常会由以下原因造成差异：

* 视频播放独特值与所有事件独特值。 如前所述，除AuthN尝试外，Adobe Primetime身份验证会为所有事件计数独特用户。 这意味着如果用户仅在（页面上）进行身份验证但未查看视频，则仍会触发独特用户计数增加。

* 对授权失败的用户进行计数 — Adobe Primetime身份验证会同时计算这些用户以及报告的数量。

<!--
## Related Information {#related-information}

- [Entitlement Service Monitoring API](/help/authentication/entitlement-service-monitoring-api.md)

-->